:root {
    --metal-dark: #1a1a1a; --metal-light: #333333; --rust: #8b4513;
    --indicator-red: #ff0000; --indicator-amber: #ffb000; --indicator-green: #00ff00; --crt-green: #39ff14;
    --font-crt: 'VT323', monospace; --font-stencila: 'Wallpoet', cursive;
}
* { box-sizing: border-box; user-select: none; }
body { margin: 0; background: #050505; color: var(--indicator-amber); font-family: var(--font-crt); overflow: hidden; width: 100vw; height: 100vh; background-image: repeating-linear-gradient(45deg, #111 0px, #111 2px, #151515 2px, #151515 4px); }
canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; opacity: 0.9; mix-blend-mode: screen;}

/* --- NEW: TERMINAL LOG --- */
#terminal-layer {
    position: absolute; bottom: 20px; right: 20px; width: 250px; height: 150px;
    background: rgba(0, 5, 0, 0.8); border: 1px solid var(--crt-green);
    padding: 10px; z-index: 90; font-family: 'VT323', monospace;
    pointer-events: none; overflow: hidden;
}
.term-header { border-bottom: 1px solid var(--crt-green); color: var(--crt-green); margin-bottom: 5px; font-size: 0.8rem; }
#live-log { color: #fff; font-size: 0.75rem; line-height: 1.2; text-shadow: 0 0 2px var(--crt-green); opacity: 0.8; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; }

/* --- NEW: CRITICAL OVERLAY --- */
#critical-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 900;
    background: rgba(255, 0, 0, 0.2); display: flex; justify-content: center; align-items: center;
    animation: flashCritical 0.2s infinite; pointer-events: none;
}
.warning-box {
    border: 5px solid red; background: rgba(0,0,0,0.8); color: red; padding: 30px;
    text-align: center; transform: rotate(-5deg); box-shadow: 0 0 50px red;
}
.warn-icon { font-size: 5rem; margin-bottom: 10px; }
.warn-text { font-family: var(--font-stencila); font-size: 2rem; letter-spacing: 5px; animation: blink 0.1s infinite; }

/* --- UI GLITCH EFFECT --- */
.ui-glitch { animation: shakeUI 0.1s infinite; filter: hue-rotate(90deg); }

/* --- EXISTING STYLES (Compact) --- */
.rust-overlay { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 5; background: radial-gradient(circle at center, transparent 40%, rgba(139, 69, 19, 0.15) 85%, rgba(0,0,0,0.9) 100%); }
.vignette-heavy { position: fixed; width: 100%; height: 100%; pointer-events: none; z-index: 6; box-shadow: inset 0 0 250px rgba(0,0,0,1); }
.crt-flicker { position: fixed; width: 100%; height: 100%; pointer-events: none; z-index: 7; background: rgba(255, 255, 255, 0.02); animation: flicker 0.1s infinite; }

.metal-panel { background: linear-gradient(180deg, #2a2a2a, #181818); border: 2px solid #000; border-top-color: #444; border-bottom-color: #0a0a0a; box-shadow: 0 5px 20px rgba(0,0,0,0.8); position: relative; padding: 15px; }
.screws-corner::before, .screws-corner::after { content: '+'; position: absolute; color: #000; font-family: sans-serif; font-weight: bold; text-shadow: 1px 1px 0 #444; font-size: 14px; top: 4px; }
.screws-corner::before { left: 4px; } .screws-corner::after { right: 4px; }
.box-shadow-inset { box-shadow: inset 3px 3px 10px #0a0a0a, inset -2px -2px 5px #333; background: #131313; }

#boot-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; display: flex; justify-content: center; align-items: center; background: #000; }
.blast-door { position: absolute; left: 0; width: 100%; height: 50%; background: linear-gradient(to bottom, #222, #111); border-bottom: 4px solid #000; z-index: 10; transition: transform 1.5s cubic-bezier(0.7, 0, 0.3, 1); }
.door-top { top: 0; border-bottom: 5px solid #000; } .door-bottom { bottom: 0; border-top: 5px solid #333; }
.hazard-stripes { position: absolute; width: 100%; height: 30px; background: repeating-linear-gradient(45deg, #222, #222 20px, #8b7d13 20px, #8b7d13 40px); box-shadow: inset 0 0 10px #000; opacity: 0.8; }
.door-top .hazard-stripes { bottom: 0; } .door-bottom .hazard-stripes { top: 0; }
.gates-open .door-top { transform: translateY(-100%); } .gates-open .door-bottom { transform: translateY(100%); }
.boot-center-mech { z-index: 20; text-align: center; }
.caution-plate { background: #8b7d13; color: #000; font-weight: bold; padding: 5px 15px; border: 2px solid #000; font-family: var(--font-stencila); margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); letter-spacing: 2px; }
.boot-terminal { background: #050505; border: 4px solid #333; padding: 20px; width: 350px; box-shadow: inset 0 0 20px #000; margin-bottom: 40px; text-align: left; }
.crt-text { color: var(--crt-green); text-shadow: 0 0 5px var(--crt-green); font-size: 1.2rem; }
.lever-container { position: relative; width: 100px; height: 160px; margin: 0 auto; }
.lever-base { position: absolute; bottom: 0; width: 100px; height: 40px; background: linear-gradient(to right, #111, #444, #111); border: 2px solid #000; border-radius: 5px 5px 0 0; }
.lever-handle { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 25px; height: 130px; background: #8b1313; border: 2px solid #000; cursor: pointer; transition: all 0.4s ease-in; border-radius: 4px; display: flex; align-items: center; justify-content: center; box-shadow: -5px 5px 10px rgba(0,0,0,0.7); }
.lever-handle::after { content: ''; position: absolute; top: -15px; width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, #ff4d4d, #8b1313); border-radius: 50%; border: 2px solid #000; }
.lever-handle span { transform: rotate(-90deg); color: #fff; font-weight: bold; font-size: 0.8rem; letter-spacing: 2px; }
.lever-pulled .lever-handle { transform: translateX(-50%) rotateX(50deg) translateY(60px); height: 80px; filter: brightness(0.7); }

#hud-layer { position: absolute; width: 100%; height: 100%; z-index: 100; pointer-events: none; }
.corner-group { position: absolute; pointer-events: auto; display: flex; flex-direction: column; gap: 15px; }
.top-left { top: 20px; left: 20px; transform: scale(0.85); transform-origin: top left; }
.top-right { top: 20px; right: 20px; transform: scale(0.85); transform-origin: top right; align-items: flex-end; }
.bottom-left { bottom: 20px; left: 20px; transform: scale(0.85); transform-origin: bottom left; }

.top-console-mini { display: flex; justify-content: space-between; align-items: center; padding: 8px 15px; width: 280px; }
.panel-label { font-family: var(--font-stencila); color: #666; letter-spacing: 2px; font-size: 0.8rem; }
.nixie-tube-container { background: #000; padding: 2px 10px; border: 2px solid #333; box-shadow: inset 0 0 15px #000; }
.nixie-text { color: var(--indicator-red); font-size: 1.5rem; text-shadow: 0 0 10px var(--indicator-red); letter-spacing: 3px; }
.left-mod { width: 280px; }
.panel-header-mech { font-size: 0.8rem; color: #555; border-bottom: 2px solid #000; margin-bottom: 15px; font-family: var(--font-stencila); text-align: center; padding-bottom: 5px; }
.timer-group { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.timer-group label { font-size: 0.8rem; color: #888; }
.mechanical-input { background: #080808; border: 2px solid #333; color: var(--indicator-amber); font-family: var(--font-crt); font-size: 1.2rem; width: 80px; padding: 5px; text-align: center; box-shadow: inset 0 0 5px #000; }
.button-bank { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;}
.btn-bezel { background: linear-gradient(180deg, #333, #111); padding: 5px; border-radius: 4px; border: 1px solid #000; box-shadow: 0 3px 6px rgba(0,0,0,0.6); display: flex; flex-direction: column; align-items: center; gap: 6px; }
.mech-push-btn { width: 50px; height: 35px; background: linear-gradient(180deg, #2a2a2a, #151515); border: 2px solid #000; color: #777; font-family: var(--font-stencila); cursor: pointer; position: relative; top: 0; transition: 0.1s; border-radius: 2px; font-size: 0.7rem;}
.mech-push-btn:active { top: 2px; background: #111; box-shadow: inset 0 2px 5px #000; }
.indicator-bulb { width: 10px; height: 10px; border-radius: 50%; background: #222; border: 1px solid #000; box-shadow: inset 0 0 2px #000; transition: 0.2s; }
.indicator-bulb.red.on { background: var(--indicator-red); box-shadow: 0 0 8px var(--indicator-red); }
.indicator-bulb.yellow.on { background: var(--indicator-amber); box-shadow: 0 0 8px var(--indicator-amber); }
.indicator-bulb.green.on { background: var(--indicator-green); box-shadow: 0 0 8px var(--indicator-green); }
.gauge-housing { height: 20px; background: #000; border: 2px solid #333; position: relative; box-shadow: inset 0 0 5px #000; }
.gauge-fluid { height: 100%; width: 0%; background: var(--indicator-red); transition: width 0.1s; }
.gauge-glass { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.05) 100%); }
.gauge-ticks { position: absolute; top:0; left:0; width:100%; height:100%; background: repeating-linear-gradient(90deg, #333, #333 1px, transparent 1px, transparent 10%); opacity: 0.5; }
.crt-housing-mini { width: 260px; height: 180px; display: flex; align-items: center; justify-content: center; background: #0d0d0d; box-shadow: inset 0 0 30px #000; }
.crt-screen-bezel { width: 92%; height: 88%; background: #000; border: 15px solid #222; border-radius: 30px / 20px; box-shadow: inset 0 0 15px #000; position: relative; overflow: hidden; }
.crt-screen-content { padding: 15px; color: var(--crt-green); position: relative; height: 100%; }
.crt-line { font-size: 1rem; margin-bottom: 10px; text-shadow: 0 0 4px var(--crt-green); }
.blink-amber { color: var(--indicator-amber); animation: blink 1s infinite; text-shadow: 0 0 5px var(--indicator-amber); }
.crt-big-text { font-size: 2.5rem; font-weight: bold; text-align: center; margin-top: 15px; animation: twitch 3s infinite; text-shadow: 2px 0 red, -2px 0 blue; }
.scanline-overlay { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.2) 0px, rgba(0,0,0,0.2) 1px, transparent 1px, transparent 4px); animation: scrollScan 5s linear infinite; }
.right-mod { width: 260px; }
.fader-group { margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
.fader-group label { font-size: 0.7rem; color: #888; }
.fader-track-metal { width: 160px; height: 8px; background: #000; border: 2px solid #333; position: relative; box-shadow: inset 0 0 5px #000; }
.fader-slot { position: absolute; top: 3px; left: 0; width: 100%; height: 2px; background: #111; }
.mech-fader { -webkit-appearance: none; width: 100%; background: transparent; position: relative; z-index: 2; }
.mech-fader::-webkit-slider-thumb { -webkit-appearance: none; height: 25px; width: 15px; background: linear-gradient(180deg, #555, #222); border: 1px solid #000; box-shadow: 0 2px 5px rgba(0,0,0,0.8); cursor: grab; margin-top: -10px; }
.toggle-group { display: flex; gap: 10px; justify-content: center; }
.toggle-switch { background: transparent; border: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
.toggle-handle { width: 12px; height: 30px; background: linear-gradient(to right, #222, #444, #222); border: 2px solid #000; position: relative; margin-bottom: 5px; }
.toggle-handle::after { content: ''; position: absolute; top: 3px; left: 50%; transform: translateX(-50%); width: 16px; height: 16px; background: radial-gradient(circle at 30% 30%, #555, #111); border: 1px solid #000; border-radius: 50%; transition: 0.2s; }
.toggle-switch.active .toggle-handle::after { top: -8px; background: radial-gradient(circle at 30% 30%, var(--indicator-amber), #8b4513); }
.toggle-text { font-family: var(--font-crt); color: #555; font-size: 0.7rem; }
.toggle-switch.active .toggle-text { color: var(--indicator-amber); text-shadow: 0 0 5px var(--indicator-amber); }

.hidden { display: none !important; }
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
@keyframes flicker { 0% { opacity: 0.95; } 50% { opacity: 1; } 52% { opacity: 0.8; } 54% { opacity: 1; } 100% { opacity: 0.95; } }
@keyframes twitch { 0% { transform: translateX(0); } 98% { transform: translateX(0); } 99% { transform: translateX(2px); } 100% { transform: translateX(0); } }
@keyframes scrollScan { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }
@keyframes flashCritical { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes shakeUI { 0% { transform: translate(0,0); } 25% { transform: translate(5px, -5px); } 50% { transform: translate(-5px, 2px); } 75% { transform: translate(5px, 5px); } 100% { transform: translate(0,0); } }